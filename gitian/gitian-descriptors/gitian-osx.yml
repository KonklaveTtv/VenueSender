---
name: "VenueSender"
reference_datetime: "2023-09-05 11:00:00"
sshkeys:
  - "/home/spencerlievens/.ssh/id_rsa"  # Specify the path to your SSH key here
remotes:
  - url: "git@github.com:KonklaveTtv/VenueSender.git"
    branch: "main"
    commit: "bc64f13c0f1bb180f8bedfd44e557d559c6a68f5"
suites:
  - "lunar"
architectures:
  - "amd64"
packages:
  - "build-essential"
  - "clang"
  - "libc++-dev"
files: []
script: |
  set -e

  # Build Curl v8.2.1 from source
  wget https://github.com/curl/curl/releases/download/curl-8_2_1/curl-8.2.1.tar.gz
  tar -xvf curl-8.2.1.tar.gz
  cd curl-8.2.1
  ./configure --with-openssl --enable-static --disable-shared
  make
  sudo make install
  cd ..

  # Build libjsoncpp 1.9.5-4 from source
  wget https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/libjsoncpp/1.9.5-4/libjsoncpp_1.9.5.orig.tar.gz
  tar -xvf libjsoncpp_1.9.5.orig.tar.gz
  cd jsoncpp-1.9.5
  mkdir -p build/debug
  cd build/debug
  cmake -DCMAKE_BUILD_TYPE=debug -DBUILD_STATIC_LIBS=ON -DBUILD_SHARED_LIBS=OFF -DARCHIVE_INSTALL_DIR=. -G "Unix Makefiles" ../../
  make
  cd ../../..

  # Build libx11 1.8.6 from source
  wget https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/libx11/2:1.8.6-1/libx11_1.8.6.orig.tar.gz
  tar -xvf libx11-libX11-1.8.6.tar.gz
  cd libx11-libX11-1.8.6
  ./autogen.sh
  ./configure --enable-static --disable-shared
  make
  sudo make install
  cd ..

  # Build libpsl 0.21.2 from source
  wget https://github.com/rockdaboot/libpsl/releases/download/0.21.2/libpsl-0.21.2.tar.gz
  tar -xvf libpsl-0.21.2.tar.gz
  cd libpsl-0.21.2
  ./configure --enable-static --disable-shared
  make
  sudo make install
  cd ..
  
  cd VenueSender
  make  # Your Makefile should handle cross-compilation for macOS
  cp bin/VenueSender $OUTDIR/VenueSender-osx-amd64

  # Sign the generated macOS executable
  gpg --output $OUTDIR/VenueSender-osx-amd64.sig --detach-sig $OUTDIR/VenueSender-osx-amd64

  # Create manifest for the macOS executable
  sha256sum $OUTDIR/VenueSender-osx-amd64 > $OUTDIR/VenueSender-osx-amd64.manifest
