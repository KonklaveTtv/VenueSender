---
name: "VenueSender"
reference_datetime: "2023-09-05 11:00:00"
sshkeys:
  - "/home/spencerlievens/.ssh/id_rsa"  # Specify the path to your SSH key here
remotes:
  - url: "git@github.com:KonklaveTtv/VenueSender.git"
    branch: "main"
    commit: "60d800d3ddc880e7c3216f8c32cbb6ad038d8ee8"
suites:
  - "lunar"
architectures:
  - "amd64"
packages:
  - "build-essential"
  - "wget"
  - "cmake"
  - "libssl-dev"
  - "libsqlite3-dev"
  - "libboost-all-dev"
files:
  - "base-lunar-amd64"
script: |
  set -e
  
  # Build Curl v7.88.1 from source
  wget https://github.com/curl/curl/releases/download/curl-7_88_1/curl-7.88.1.tar.gz
  tar -xvf curl-7.88.1.tar.gz
  cd curl-7.88.1
  ./configure --with-openssl --enable-static --disable-shared
  make
  sudo make install
  cd ..

  # Build libjsoncpp 1.9.5-4 from source
  wget https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/libjsoncpp/1.9.5-4/libjsoncpp_1.9.5.orig.tar.gz
  tar -xvf libjsoncpp_1.9.5.orig.tar.gz
  cd libjsoncpp-1.9.5
  mkdir -p build/debug
  cd build/debug
  cmake -DCMAKE_BUILD_TYPE=debug -DBUILD_STATIC_LIBS=ON -DBUILD_SHARED_LIBS=OFF -DARCHIVE_INSTALL_DIR=. -G "Unix Makefiles" ../../
  make
  sudo make install
  cd ../../..

  # Build libx11 1.8.4 from source
  wget https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/libx11/2:1.8.4-2/libx11_1.8.4.orig.tar.gz
  tar -xvf libx11_1.8.4.orig.tar.gz
  cd libx11-1.8.4
  ./configure --enable-static --disable-shared
  make
  sudo make install
  cd ..

  # Build libpsl 0.21.2 from source
  wget https://github.com/rockdaboot/libpsl/releases/download/0.21.2/libpsl-0.21.2.tar.gz
  tar -xvf libpsl-0.21.2.tar.gz
  cd libpsl-0.21.2
  ./configure --enable-static --disable-shared
  make
  sudo make install
  cd ..

  # Now build the main project
  cd VenueSender
  make
  cp bin/VenueSender $OUTDIR/VenueSender-linux-amd64

  # Sign the generated Linux executable
  gpg --output $OUTDIR/VenueSender-linux-amd64.sig --detach-sig $OUTDIR/VenueSender-linux-amd64

  # Create manifest for the Linux executable
  sha256sum $OUTDIR/VenueSender-linux-amd64 > $OUTDIR/VenueSender-linux-amd64.manifest